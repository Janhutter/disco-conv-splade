#!/bin/bash

#SBATCH --partition=gpu_h100
#SBATCH --gpus=2
#SBATCH --job-name=eval
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=9
#SBATCH --time=8:00:00
#SBATCH --output=%A.out


seed=$1

dataset=$2
capitalized_dataset=${dataset^^}
model=$3

config=disco_${dataset}_${model}.yaml

if [ "$dataset" == "ikat23" ]; then
    index_dir=/scratch-shared/disco/DATA/ikat23/splade_index/splade_index/
elif [ "$dataset" == "ikat24" ]; then
    index_dir=/scratch-shared/disco/DATA/ikat23/splade_index/splade_index/
else
    index_dir=/scratch-shared/disco/DATA/${dataset}/${dataset}_index_self/
fi

out_dir=/scratch-shared/disco/disco_${capitalized_dataset}_${model}_out_${seed}/
# ckpt_dir=/scratch-shared/disco/disco_TOPIOCQA_multi_1765204072/
ckpt_dir=/scratch-shared/disco/disco_${capitalized_dataset}_${model}/

export SPLADE_CONFIG_NAME=$config

python -m splade.retrieve \
    --config-name=$config \
    config.checkpoint_dir=$ckpt_dir \
    config.index_dir=$index_dir \
    config.out_dir=$out_dir \
    config.seed=$seed