#!/bin/bash

#SBATCH --partition=gpu_h100
#SBATCH --gpus=1
#SBATCH --job-name=eval
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=9
#SBATCH --time=1:00:00
#SBATCH --output=%A.out

seed=$1

dataset=$2
capitalized_dataset=${dataset^^}
model=$3

config=disco_${dataset}_${model}.yaml
ckpt_dir=EXP/checkpoint_exp/disco_${capitalized_dataset}_${model}/
index_dir=DATA/${dataset}_index_self/
out_dir=EXP/checkpoint_exp/disco_${capitalized_dataset}_${model}_out_${seed}/

# Ensure CONFIG_CHOICE.py uses the same config (including subfolders)
export SPLADE_CONFIG_NAME=$config

python -m splade.retrieve \
    --config-name=$config \
    config.checkpoint_dir=$ckpt_dir \
    config.index_dir=$index_dir \
    config.out_dir=$out_dir \
    config.seed=$seed